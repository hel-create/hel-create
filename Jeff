import pandas as pd

# 假设 df_pc_match_stat 已经包含你需要的列

# 计算每个 condo_counts 的总行数
total_counts = df_pc_match_stat.groupby('condo_counts').size().reset_index(name='total_counts')

# 计算每个 condo_counts 中 gross_rental_income 为 0 的行数
zero_gross_rental_income_counts = df_pc_match_stat[df_pc_match_stat['L12599 - Gross Rental Income_4'] == 0].groupby('condo_counts').size().reset_index(name='zero_gross_rental_income_counts')

# 合并两个 DataFrame
merged_counts = pd.merge(total_counts, zero_gross_rental_income_counts, on='condo_counts', how='left')

# 计算比例
merged_counts['proportion_zero_gross_rental_income'] = merged_counts['zero_gross_rental_income_counts'] / merged_counts['total_counts']

# 显示结果
print(merged_counts)

# 导出结果到 CSV 文件
output_file = 'proportion_zero_gross_rental_income.csv'
merged_counts.to_csv(output_file, index=False)
print(f'Proportion of zero gross rental income has been exported to {output_file}')
